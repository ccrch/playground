---
import Layout from '../layouts/layout.astro'

export const frontmatter = {
  baseClass: 'logo-3d',
  title: 'Logo',
}

const svg = () => {
  return `
    <svg width="300" height="169" viewBox="0 0 300 169" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M200.57 168.513L300 0H270.346L185.736 143.32L200.57 168.513Z" fill="#FD3D00"></path>
      <path d="M175.228 125.635L249.317 0H219.449L160.394 100.243L175.228 125.635Z" fill="#FD3D00"></path>
      <path d="M198.434 0H0L99.2169 168.513L198.434 0ZM153.972 25.1669L99.2169 118.126L44.4747 25.1669H153.972Z" fill="#FD3D00"></path>
    </svg>
  `
}
---

<script>
  import gsap from 'gsap'
  import { throttle } from 'throttle-debounce'

  document.querySelectorAll('.logo__layers > div').forEach((el, index) => {
    gsap.set(el, {
      // opacity: 1 - index * 0.1,
      // rotateY: (index - 5) * 3,
      // rotateX: (index - 5) * 1.5,
      z: `${-index * 0.07}vw`,
    })
  })

  // let isRotating = false

  document.querySelector('body').addEventListener('click', (event) => {
    // if (isRotating) return
    // isRotating = true

    gsap.to('.logo__layers', {
      clearProps: 'transform',
      duration: 2,
      ease: 'power4.inOut',
      rotateY: 360 * (event.clientX > window.innerWidth / 2 ? 1 : -1),
      overwrite: true,
      // onComplete: () => {
      //   isRotating = false
      // },
    })
  })

  const onMouseMove = (event) => {
    const x = event.touches ? event.touches[0].clientX : event.clientX
    const y = event.touches ? event.touches[0].clientY : event.clientY

    const xPercent = (x / window.innerWidth - 0.5) * 100
    const yPercent = (y / window.innerHeight - 0.5) * 100

    const modifier = 1.3

    gsap.to('.logo', {
      duration: 1,
      ease: 'power4.out',
      overwrite: true,
      rotateY: `${xPercent * modifier}%`,
      rotateX: `${-yPercent * modifier}%`,
    })
  }

  window.addEventListener('mousemove', throttle(33, onMouseMove))
</script>

<style lang="scss" is:global>
  .logo-3d-container {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100vw;
    height: 100vh;
    transform-style: preserve-3d;
    perspective: 1234px;

    .logo {
      position: relative;
      z-index: 1;
      transform-style: preserve-3d;
      width: min(666px, 33vw);

      .logo__layers {
        transform-style: preserve-3d;
        width: 100%;
        height: 100%;

        > div {
          width: 100%;
          aspect-ratio: 300 / 169;

          svg {
            width: 100%;
            height: auto;
          }
        }

        > div:not(:first-child) {
          position: absolute;
          inset: 0;
          z-index: 1;

          svg path {
            fill: darken(#fd3d00, 7%);
          }
        }

        > div:last-child svg path {
          fill: #fd3d00;
        }
      }
    }
  }
</style>

<Layout baseClass={frontmatter.baseClass} title={frontmatter.title} navigationHidden={true}>
  <div class="logo-3d-container">
    <div class="logo">
      <div class="logo__layers">
        {
          Array.from({ length: 33 }).map(() => {
            return <div set:html={svg()} />
          })
        }
      </div>
    </div>
  </div>
</Layout>
